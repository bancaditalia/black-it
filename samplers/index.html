
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../schedulers/">
      
      
        <link rel="next" href="../losses/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Samplers - black-it documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#black_it.samplers.base.BaseSampler" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="black-it documentation" class="md-header__button md-logo" aria-label="black-it documentation" data-md-component="logo">
      
  <img src="../logo/monogram_512.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            black-it documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Samplers
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/bancaditalia/black-it" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    bancaditalia/black-it
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="black-it documentation" class="md-nav__button md-logo" aria-label="black-it documentation" data-md-component="logo">
      
  <img src="../logo/monogram_512.png" alt="logo">

    </a>
    black-it documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/bancaditalia/black-it" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    bancaditalia/black-it
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../description/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How it works
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples and tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples and tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tests_on_toy_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Toy model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../slack_stock_price_shock/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Simple shock model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../finding_the_parameters_of_a_SIR_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SIR model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../boltzmann_wealth_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Boltzmann wealth model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview_of_the_different_samplers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Different samplers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../benchmarking_samplers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Benchmarking samplers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview_of_plotting_functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plotting tutorial
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../simulator_interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Interface with simulators
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../checkpointing_parallelisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Checkpointing and parallelisation
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Extending Black-it
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Code Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Code Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../calibrator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Calibrator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../schedulers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Schedulers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Samplers
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Samplers
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.base.BaseSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.base.BaseSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.base.BaseSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.base.BaseSampler.find_and_get_duplicates" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_and_get_duplicates()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.base.BaseSampler.sample" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.base.BaseSampler.sample_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample_batch()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_uniform.RandomUniformSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.random_uniform.RandomUniformSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_uniform.RandomUniformSampler.sample_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample_batch()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.halton.HaltonSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.halton.HaltonSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.halton.HaltonSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.halton.HaltonSampler.sample_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample_batch()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.r_sequence.RSequenceSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.r_sequence.RSequenceSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.r_sequence.RSequenceSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.r_sequence.RSequenceSampler.compute_phi" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_phi()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.r_sequence.RSequenceSampler.sample_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample_batch()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.best_batch.BestBatchSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.best_batch.BestBatchSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.best_batch.BestBatchSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.best_batch.BestBatchSampler.sample_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample_batch()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.gaussian_process.GaussianProcessSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.gaussian_process.GaussianProcessSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.gaussian_process.GaussianProcessSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.gaussian_process.GaussianProcessSampler.fit" class="md-nav__link">
    <span class="md-ellipsis">
      
        fit()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.gaussian_process.GaussianProcessSampler.get_quantiles" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_quantiles()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.gaussian_process.GaussianProcessSampler.predict" class="md-nav__link">
    <span class="md-ellipsis">
      
        predict()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_forest.RandomForestSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.random_forest.RandomForestSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_forest.RandomForestSampler.criterion" class="md-nav__link">
    <span class="md-ellipsis">
      
        criterion
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_forest.RandomForestSampler.n_classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        n_classes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_forest.RandomForestSampler.n_estimators" class="md-nav__link">
    <span class="md-ellipsis">
      
        n_estimators
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_forest.RandomForestSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_forest.RandomForestSampler.fit" class="md-nav__link">
    <span class="md-ellipsis">
      
        fit()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_forest.RandomForestSampler.predict" class="md-nav__link">
    <span class="md-ellipsis">
      
        predict()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_forest.RandomForestSampler.prepare_data_for_classifier" class="md-nav__link">
    <span class="md-ellipsis">
      
        prepare_data_for_classifier()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.xgboost.XGBoostSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler.alpha" class="md-nav__link">
    <span class="md-ellipsis">
      
        alpha
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler.colsample_bytree" class="md-nav__link">
    <span class="md-ellipsis">
      
        colsample_bytree
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler.learning_rate" class="md-nav__link">
    <span class="md-ellipsis">
      
        learning_rate
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler.max_depth" class="md-nav__link">
    <span class="md-ellipsis">
      
        max_depth
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler.n_estimators" class="md-nav__link">
    <span class="md-ellipsis">
      
        n_estimators
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler.fit" class="md-nav__link">
    <span class="md-ellipsis">
      
        fit()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler.predict" class="md-nav__link">
    <span class="md-ellipsis">
      
        predict()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.particle_swarm.ParticleSwarmSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.particle_swarm.ParticleSwarmSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.particle_swarm.ParticleSwarmSampler.c1" class="md-nav__link">
    <span class="md-ellipsis">
      
        c1
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.particle_swarm.ParticleSwarmSampler.c2" class="md-nav__link">
    <span class="md-ellipsis">
      
        c2
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.particle_swarm.ParticleSwarmSampler.inertia" class="md-nav__link">
    <span class="md-ellipsis">
      
        inertia
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.particle_swarm.ParticleSwarmSampler.is_set_up" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_set_up
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.particle_swarm.ParticleSwarmSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.particle_swarm.ParticleSwarmSampler.reset" class="md-nav__link">
    <span class="md-ellipsis">
      
        reset()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.particle_swarm.ParticleSwarmSampler.sample_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample_batch()
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../losses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Loss functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../search_space/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search space
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../citing_black_it/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Citing Black-it
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.base.BaseSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.base.BaseSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.base.BaseSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.base.BaseSampler.find_and_get_duplicates" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_and_get_duplicates()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.base.BaseSampler.sample" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.base.BaseSampler.sample_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample_batch()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_uniform.RandomUniformSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.random_uniform.RandomUniformSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_uniform.RandomUniformSampler.sample_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample_batch()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.halton.HaltonSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.halton.HaltonSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.halton.HaltonSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.halton.HaltonSampler.sample_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample_batch()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.r_sequence.RSequenceSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.r_sequence.RSequenceSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.r_sequence.RSequenceSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.r_sequence.RSequenceSampler.compute_phi" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_phi()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.r_sequence.RSequenceSampler.sample_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample_batch()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.best_batch.BestBatchSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.best_batch.BestBatchSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.best_batch.BestBatchSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.best_batch.BestBatchSampler.sample_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample_batch()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.gaussian_process.GaussianProcessSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.gaussian_process.GaussianProcessSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.gaussian_process.GaussianProcessSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.gaussian_process.GaussianProcessSampler.fit" class="md-nav__link">
    <span class="md-ellipsis">
      
        fit()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.gaussian_process.GaussianProcessSampler.get_quantiles" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_quantiles()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.gaussian_process.GaussianProcessSampler.predict" class="md-nav__link">
    <span class="md-ellipsis">
      
        predict()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_forest.RandomForestSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.random_forest.RandomForestSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_forest.RandomForestSampler.criterion" class="md-nav__link">
    <span class="md-ellipsis">
      
        criterion
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_forest.RandomForestSampler.n_classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        n_classes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_forest.RandomForestSampler.n_estimators" class="md-nav__link">
    <span class="md-ellipsis">
      
        n_estimators
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_forest.RandomForestSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_forest.RandomForestSampler.fit" class="md-nav__link">
    <span class="md-ellipsis">
      
        fit()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_forest.RandomForestSampler.predict" class="md-nav__link">
    <span class="md-ellipsis">
      
        predict()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.random_forest.RandomForestSampler.prepare_data_for_classifier" class="md-nav__link">
    <span class="md-ellipsis">
      
        prepare_data_for_classifier()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.xgboost.XGBoostSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler.alpha" class="md-nav__link">
    <span class="md-ellipsis">
      
        alpha
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler.colsample_bytree" class="md-nav__link">
    <span class="md-ellipsis">
      
        colsample_bytree
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler.learning_rate" class="md-nav__link">
    <span class="md-ellipsis">
      
        learning_rate
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler.max_depth" class="md-nav__link">
    <span class="md-ellipsis">
      
        max_depth
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler.n_estimators" class="md-nav__link">
    <span class="md-ellipsis">
      
        n_estimators
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler.fit" class="md-nav__link">
    <span class="md-ellipsis">
      
        fit()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.xgboost.XGBoostSampler.predict" class="md-nav__link">
    <span class="md-ellipsis">
      
        predict()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.particle_swarm.ParticleSwarmSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        black_it.samplers.particle_swarm.ParticleSwarmSampler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.particle_swarm.ParticleSwarmSampler.c1" class="md-nav__link">
    <span class="md-ellipsis">
      
        c1
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.particle_swarm.ParticleSwarmSampler.c2" class="md-nav__link">
    <span class="md-ellipsis">
      
        c2
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.particle_swarm.ParticleSwarmSampler.inertia" class="md-nav__link">
    <span class="md-ellipsis">
      
        inertia
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.particle_swarm.ParticleSwarmSampler.is_set_up" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_set_up
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.particle_swarm.ParticleSwarmSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.particle_swarm.ParticleSwarmSampler.reset" class="md-nav__link">
    <span class="md-ellipsis">
      
        reset()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black_it.samplers.particle_swarm.ParticleSwarmSampler.sample_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample_batch()
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Samplers</h1>

<div class="doc doc-object doc-class">

<a id="black_it.samplers.base.BaseSampler"></a>
    <div class="doc doc-contents first">

      <p>BaseSampler interface.</p>
<p>This is the base class for all samplers.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseSampler</span><span class="p">(</span><span class="n">BaseSeedable</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;BaseSampler interface.</span>

<span class="sd">    This is the base class for all samplers.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_deduplication_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the sampler.</span>

<span class="sd">        Args:</span>
<span class="sd">            batch_size: the number of points sampled every time the sampler is called</span>
<span class="sd">            random_state: the internal state of the sampler, fixing this numbers the sampler behaves deterministically</span>
<span class="sd">            max_deduplication_passes: maximum number of duplication passes done to avoid sampling repeated parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BaseSeedable</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_deduplication_passes</span> <span class="o">=</span> <span class="n">max_deduplication_passes</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sample_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">search_space</span><span class="p">:</span> <span class="n">SearchSpace</span><span class="p">,</span>
        <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sample a number of new parameters fixed by the &#39;batch_size&#39; attribute.</span>

<span class="sd">        Args:</span>
<span class="sd">            batch_size: number of samples to collect</span>
<span class="sd">            search_space: an object containing the details of the parameter search space</span>
<span class="sd">            existing_points: the parameters already sampled</span>
<span class="sd">            existing_losses: the loss corresponding to the sampled parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            the new parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">search_space</span><span class="p">:</span> <span class="n">SearchSpace</span><span class="p">,</span>
        <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sample from the search space.</span>

<span class="sd">        Args:</span>
<span class="sd">            search_space: an object containing the details of the parameter search space</span>
<span class="sd">            existing_points: the parameters already sampled</span>
<span class="sd">            existing_losses: the loss corresponding to the sampled parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            the sampled parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_batch</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="n">search_space</span><span class="p">,</span>
            <span class="n">existing_points</span><span class="p">,</span>
            <span class="n">existing_losses</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_deduplication_passes</span><span class="p">):</span>
            <span class="n">duplicates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_and_get_duplicates</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">existing_points</span><span class="p">)</span>

            <span class="n">num_duplicates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">num_duplicates</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">new_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_batch</span><span class="p">(</span>
                <span class="n">num_duplicates</span><span class="p">,</span>
                <span class="n">search_space</span><span class="p">,</span>
                <span class="n">existing_points</span><span class="p">,</span>
                <span class="n">existing_losses</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">samples</span><span class="p">[</span><span class="n">duplicates</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_samples</span>

            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_deduplication_passes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Warning: Repeated samples still found after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_deduplication_passes</span><span class="si">}</span><span class="s2"> duplication passes.&quot;</span>
                    <span class="s2">&quot; This is probably due to a small search space.&quot;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">samples</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_and_get_duplicates</span><span class="p">(</span>
        <span class="n">new_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the points in &#39;new_points&#39; that are already present in &#39;existing_points&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_points: candidates points for the sampler</span>
<span class="sd">            existing_points: previously sampled points</span>

<span class="sd">        Returns:</span>
<span class="sd">            the location of the duplicates in &#39;new_points&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">existing_points</span><span class="p">,</span> <span class="n">new_points</span><span class="p">))</span>
        <span class="n">unq</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">all_points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">repeated_groups</span> <span class="o">=</span> <span class="n">unq</span><span class="p">[</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">repeated_pos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">repeated_groups</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">repeated_group</span> <span class="ow">in</span> <span class="n">repeated_groups</span><span class="p">:</span>
                <span class="n">repeated_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">new_points</span> <span class="o">==</span> <span class="n">repeated_group</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">repeated_idx</span><span class="p">:</span>
                    <span class="n">repeated_pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># noqa: PERF401</span>

        <span class="k">return</span> <span class="n">repeated_pos</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.base.BaseSampler.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_deduplication_passes</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Initialize the sampler.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>batch_size</code></td>
        <td><code>int</code></td>
        <td><p>the number of points sampled every time the sampler is called</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>random_state</code></td>
        <td><code>int | None</code></td>
        <td><p>the internal state of the sampler, fixing this numbers the sampler behaves deterministically</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_deduplication_passes</code></td>
        <td><code>int</code></td>
        <td><p>maximum number of duplication passes done to avoid sampling repeated parameters</p></td>
        <td><code>5</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_deduplication_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the sampler.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch_size: the number of points sampled every time the sampler is called</span>
<span class="sd">        random_state: the internal state of the sampler, fixing this numbers the sampler behaves deterministically</span>
<span class="sd">        max_deduplication_passes: maximum number of duplication passes done to avoid sampling repeated parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">BaseSeedable</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">batch_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_deduplication_passes</span> <span class="o">=</span> <span class="n">max_deduplication_passes</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.base.BaseSampler.find_and_get_duplicates" class="doc doc-heading">
<code class="highlight language-python"><span class="n">find_and_get_duplicates</span><span class="p">(</span><span class="n">new_points</span><span class="p">,</span> <span class="n">existing_points</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Find the points in 'new_points' that are already present in 'existing_points'.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>new_points</code></td>
        <td><code>NDArray[np.float64]</code></td>
        <td><p>candidates points for the sampler</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>existing_points</code></td>
        <td><code>NDArray[np.float64]</code></td>
        <td><p>previously sampled points</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>list</code></td>
      <td><p>the location of the duplicates in 'new_points'</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">find_and_get_duplicates</span><span class="p">(</span>
    <span class="n">new_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the points in &#39;new_points&#39; that are already present in &#39;existing_points&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">        new_points: candidates points for the sampler</span>
<span class="sd">        existing_points: previously sampled points</span>

<span class="sd">    Returns:</span>
<span class="sd">        the location of the duplicates in &#39;new_points&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">existing_points</span><span class="p">,</span> <span class="n">new_points</span><span class="p">))</span>
    <span class="n">unq</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">all_points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">repeated_groups</span> <span class="o">=</span> <span class="n">unq</span><span class="p">[</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">repeated_pos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">repeated_groups</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">repeated_group</span> <span class="ow">in</span> <span class="n">repeated_groups</span><span class="p">:</span>
            <span class="n">repeated_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">new_points</span> <span class="o">==</span> <span class="n">repeated_group</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">repeated_idx</span><span class="p">:</span>
                <span class="n">repeated_pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># noqa: PERF401</span>

    <span class="k">return</span> <span class="n">repeated_pos</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.base.BaseSampler.sample" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_space</span><span class="p">,</span> <span class="n">existing_points</span><span class="p">,</span> <span class="n">existing_losses</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Sample from the search space.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>search_space</code></td>
        <td><code>SearchSpace</code></td>
        <td><p>an object containing the details of the parameter search space</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>existing_points</code></td>
        <td><code>NDArray[np.float64]</code></td>
        <td><p>the parameters already sampled</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>existing_losses</code></td>
        <td><code>NDArray[np.float64]</code></td>
        <td><p>the loss corresponding to the sampled parameters</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>NDArray[np.float64]</code></td>
      <td><p>the sampled parameters</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">SearchSpace</span><span class="p">,</span>
    <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample from the search space.</span>

<span class="sd">    Args:</span>
<span class="sd">        search_space: an object containing the details of the parameter search space</span>
<span class="sd">        existing_points: the parameters already sampled</span>
<span class="sd">        existing_losses: the loss corresponding to the sampled parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        the sampled parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
        <span class="n">search_space</span><span class="p">,</span>
        <span class="n">existing_points</span><span class="p">,</span>
        <span class="n">existing_losses</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_deduplication_passes</span><span class="p">):</span>
        <span class="n">duplicates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_and_get_duplicates</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">existing_points</span><span class="p">)</span>

        <span class="n">num_duplicates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">num_duplicates</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">new_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_batch</span><span class="p">(</span>
            <span class="n">num_duplicates</span><span class="p">,</span>
            <span class="n">search_space</span><span class="p">,</span>
            <span class="n">existing_points</span><span class="p">,</span>
            <span class="n">existing_losses</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">samples</span><span class="p">[</span><span class="n">duplicates</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_samples</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_deduplication_passes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Warning: Repeated samples still found after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_deduplication_passes</span><span class="si">}</span><span class="s2"> duplication passes.&quot;</span>
                <span class="s2">&quot; This is probably due to a small search space.&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">samples</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.base.BaseSampler.sample_batch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sample_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">search_space</span><span class="p">,</span> <span class="n">existing_points</span><span class="p">,</span> <span class="n">existing_losses</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Sample a number of new parameters fixed by the 'batch_size' attribute.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>batch_size</code></td>
        <td><code>int</code></td>
        <td><p>number of samples to collect</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>search_space</code></td>
        <td><code>SearchSpace</code></td>
        <td><p>an object containing the details of the parameter search space</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>existing_points</code></td>
        <td><code>NDArray[np.float64]</code></td>
        <td><p>the parameters already sampled</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>existing_losses</code></td>
        <td><code>NDArray[np.float64]</code></td>
        <td><p>the loss corresponding to the sampled parameters</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>NDArray[np.float64]</code></td>
      <td><p>the new parameters</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sample_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">SearchSpace</span><span class="p">,</span>
    <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample a number of new parameters fixed by the &#39;batch_size&#39; attribute.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch_size: number of samples to collect</span>
<span class="sd">        search_space: an object containing the details of the parameter search space</span>
<span class="sd">        existing_points: the parameters already sampled</span>
<span class="sd">        existing_losses: the loss corresponding to the sampled parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        the new parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">

<a id="black_it.samplers.random_uniform.RandomUniformSampler"></a>
    <div class="doc doc-contents first">

      <p>Random uniform sampling.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/random_uniform.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RandomUniformSampler</span><span class="p">(</span><span class="n">BaseSampler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Random uniform sampling.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">search_space</span><span class="p">:</span> <span class="n">SearchSpace</span><span class="p">,</span>
        <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>  <span class="c1"># noqa: ARG002</span>
        <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>  <span class="c1"># noqa: ARG002</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sample uniformly from the search space.</span>

<span class="sd">        Args:</span>
<span class="sd">            batch_size: the number of points to sample</span>
<span class="sd">            search_space: an object containing the details of the parameter search space</span>
<span class="sd">            existing_points: the parameters already sampled</span>
<span class="sd">            existing_losses: the loss corresponding to the sampled parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            the sampled parameters (an array of shape `(self.batch_size, search_space.dims)`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">search_space</span><span class="o">.</span><span class="n">dims</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">search_space</span><span class="o">.</span><span class="n">param_grid</span><span class="p">):</span>
            <span class="n">candidates</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">candidates</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.random_uniform.RandomUniformSampler.sample_batch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sample_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">search_space</span><span class="p">,</span> <span class="n">existing_points</span><span class="p">,</span> <span class="n">existing_losses</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Sample uniformly from the search space.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>batch_size</code></td>
        <td><code>int</code></td>
        <td><p>the number of points to sample</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>search_space</code></td>
        <td><code>SearchSpace</code></td>
        <td><p>an object containing the details of the parameter search space</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>existing_points</code></td>
        <td><code>ndarray</code></td>
        <td><p>the parameters already sampled</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>existing_losses</code></td>
        <td><code>ndarray</code></td>
        <td><p>the loss corresponding to the sampled parameters</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>ndarray</code></td>
      <td><p>the sampled parameters (an array of shape <code>(self.batch_size, search_space.dims)</code>)</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/random_uniform.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">SearchSpace</span><span class="p">,</span>
    <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>  <span class="c1"># noqa: ARG002</span>
    <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>  <span class="c1"># noqa: ARG002</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample uniformly from the search space.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch_size: the number of points to sample</span>
<span class="sd">        search_space: an object containing the details of the parameter search space</span>
<span class="sd">        existing_points: the parameters already sampled</span>
<span class="sd">        existing_losses: the loss corresponding to the sampled parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        the sampled parameters (an array of shape `(self.batch_size, search_space.dims)`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">search_space</span><span class="o">.</span><span class="n">dims</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">search_space</span><span class="o">.</span><span class="n">param_grid</span><span class="p">):</span>
        <span class="n">candidates</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,))</span>
    <span class="k">return</span> <span class="n">candidates</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">

<a id="black_it.samplers.halton.HaltonSampler"></a>
    <div class="doc doc-contents first">

      <p>Halton low discrepancy sequence.</p>
<p>This snippet implements the Halton sequence following the generalization of
a sequence of <em>Van der Corput</em> in n-dimensions.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/halton.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">HaltonSampler</span><span class="p">(</span><span class="n">BaseSampler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Halton low discrepancy sequence.</span>

<span class="sd">    This snippet implements the Halton sequence following the generalization of</span>
<span class="sd">    a sequence of *Van der Corput* in n-dimensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_deduplication_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the sampler.</span>

<span class="sd">        Args:</span>
<span class="sd">            batch_size: the number of points sampled every time the sampler is called</span>
<span class="sd">            random_state: the random state of the sampler, fixing this number the sampler behaves deterministically</span>
<span class="sd">            max_deduplication_passes: the maximum number of sample deduplication passes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">random_state</span><span class="p">,</span> <span class="n">max_deduplication_passes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prime_number_generator</span> <span class="o">=</span> <span class="n">_CachedPrimesCalculator</span><span class="p">()</span>

        <span class="c1"># drop first N entries to avoid linear correlation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_sequence_index</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_random_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the random state (private use).</span>

<span class="sd">        For the Halton sampler, it also resets the sequence index.</span>

<span class="sd">        Args:</span>
<span class="sd">            random_state: the random seed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_set_random_state</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_sequence_index</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_reset_sequence_index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the sequence index pointer.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sequence_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span>
            <span class="n">_MIN_SEQUENCE_START_INDEX</span><span class="p">,</span>
            <span class="n">_MAX_SEQUENCE_START_INDEX</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">search_space</span><span class="p">:</span> <span class="n">SearchSpace</span><span class="p">,</span>
        <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>  <span class="c1"># noqa: ARG002</span>
        <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>  <span class="c1"># noqa: ARG002</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sample points using Halton sequence.</span>

<span class="sd">        Args:</span>
<span class="sd">            batch_size: the number of samples</span>
<span class="sd">            search_space: an object containing the details of the parameter search space</span>
<span class="sd">            existing_points: the parameters already sampled (not used)</span>
<span class="sd">            existing_losses: the loss corresponding to the sampled parameters (not used)</span>

<span class="sd">        Returns:</span>
<span class="sd">            the parameter sampled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unit_cube_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_halton</span><span class="p">(</span>
            <span class="n">batch_size</span><span class="p">,</span>
            <span class="n">search_space</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">p_bounds</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_space</span><span class="o">.</span><span class="n">parameters_bounds</span>
        <span class="n">sampled_points</span> <span class="o">=</span> <span class="n">p_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">unit_cube_points</span> <span class="o">*</span> <span class="p">(</span><span class="n">p_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">digitize_data</span><span class="p">(</span><span class="n">sampled_points</span><span class="p">,</span> <span class="n">search_space</span><span class="o">.</span><span class="n">param_grid</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_halton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a Halton sequence.</span>

<span class="sd">        It uses a simple prime number generator, which takes the first `dims` primes.</span>

<span class="sd">        Args:</span>
<span class="sd">            nb_samples: number of samples</span>
<span class="sd">            dims: the number of dimensions of the space to sample from the unitary cube</span>

<span class="sd">        Returns:</span>
<span class="sd">            sequence of Halton.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bases</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prime_number_generator</span><span class="o">.</span><span class="n">get_n_primes</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span>
        <span class="c1"># Generate a sample using a Halton sequence.</span>
        <span class="n">sample</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">halton</span><span class="p">(</span>
            <span class="n">sample_size</span><span class="o">=</span><span class="n">nb_samples</span><span class="p">,</span>
            <span class="n">bases</span><span class="o">=</span><span class="n">bases</span><span class="p">,</span>
            <span class="n">n_start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sequence_index</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># increment sequence start index for the next sampling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sequence_index</span> <span class="o">+=</span> <span class="n">nb_samples</span>
        <span class="k">return</span> <span class="n">sample</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.halton.HaltonSampler.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_deduplication_passes</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Initialize the sampler.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>batch_size</code></td>
        <td><code>int</code></td>
        <td><p>the number of points sampled every time the sampler is called</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>random_state</code></td>
        <td><code>int | None</code></td>
        <td><p>the random state of the sampler, fixing this number the sampler behaves deterministically</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_deduplication_passes</code></td>
        <td><code>int</code></td>
        <td><p>the maximum number of sample deduplication passes.</p></td>
        <td><code>5</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/halton.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_deduplication_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the sampler.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch_size: the number of points sampled every time the sampler is called</span>
<span class="sd">        random_state: the random state of the sampler, fixing this number the sampler behaves deterministically</span>
<span class="sd">        max_deduplication_passes: the maximum number of sample deduplication passes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">random_state</span><span class="p">,</span> <span class="n">max_deduplication_passes</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_prime_number_generator</span> <span class="o">=</span> <span class="n">_CachedPrimesCalculator</span><span class="p">()</span>

    <span class="c1"># drop first N entries to avoid linear correlation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_reset_sequence_index</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.halton.HaltonSampler.sample_batch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sample_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">search_space</span><span class="p">,</span> <span class="n">existing_points</span><span class="p">,</span> <span class="n">existing_losses</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Sample points using Halton sequence.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>batch_size</code></td>
        <td><code>int</code></td>
        <td><p>the number of samples</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>search_space</code></td>
        <td><code>SearchSpace</code></td>
        <td><p>an object containing the details of the parameter search space</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>existing_points</code></td>
        <td><code>NDArray[np.float64]</code></td>
        <td><p>the parameters already sampled (not used)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>existing_losses</code></td>
        <td><code>NDArray[np.float64]</code></td>
        <td><p>the loss corresponding to the sampled parameters (not used)</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>NDArray[np.float64]</code></td>
      <td><p>the parameter sampled</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/halton.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">SearchSpace</span><span class="p">,</span>
    <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>  <span class="c1"># noqa: ARG002</span>
    <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>  <span class="c1"># noqa: ARG002</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample points using Halton sequence.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch_size: the number of samples</span>
<span class="sd">        search_space: an object containing the details of the parameter search space</span>
<span class="sd">        existing_points: the parameters already sampled (not used)</span>
<span class="sd">        existing_losses: the loss corresponding to the sampled parameters (not used)</span>

<span class="sd">    Returns:</span>
<span class="sd">        the parameter sampled</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit_cube_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_halton</span><span class="p">(</span>
        <span class="n">batch_size</span><span class="p">,</span>
        <span class="n">search_space</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">p_bounds</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_space</span><span class="o">.</span><span class="n">parameters_bounds</span>
    <span class="n">sampled_points</span> <span class="o">=</span> <span class="n">p_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">unit_cube_points</span> <span class="o">*</span> <span class="p">(</span><span class="n">p_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">digitize_data</span><span class="p">(</span><span class="n">sampled_points</span><span class="p">,</span> <span class="n">search_space</span><span class="o">.</span><span class="n">param_grid</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">

<a id="black_it.samplers.r_sequence.RSequenceSampler"></a>
    <div class="doc doc-contents first">

      <p>The R-sequence sampler.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/r_sequence.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RSequenceSampler</span><span class="p">(</span><span class="n">BaseSampler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The R-sequence sampler.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_deduplication_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the sampler.</span>

<span class="sd">        Args:</span>
<span class="sd">            batch_size: the number of points sampled every time the sampler is called</span>
<span class="sd">            random_state: the random state of the sampler, fixing this number the sampler behaves deterministically</span>
<span class="sd">            max_deduplication_passes: (non-negative integer) the maximum number of deduplication passes that are made</span>
<span class="sd">                after every batch sampling. Default: 0, i.e. no deduplication happens.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">random_state</span><span class="p">,</span> <span class="n">max_deduplication_passes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sequence_index</span><span class="p">:</span> <span class="nb">int</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sequence_start</span><span class="p">:</span> <span class="nb">float</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">compute_phi</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nb_dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an approximation of phi^nb_dims.</span>

<span class="sd">        Args:</span>
<span class="sd">            nb_dims: the number of dimensions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            phi^nb_dims</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_arg</span><span class="p">(</span><span class="n">nb_dims</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;nb_dims should be greater than 0, got </span><span class="si">{</span><span class="n">nb_dims</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">phi</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span>
        <span class="n">old_phi</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="n">old_phi</span> <span class="o">!=</span> <span class="n">phi</span><span class="p">:</span>
            <span class="n">old_phi</span> <span class="o">=</span> <span class="n">phi</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">phi</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">nb_dims</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">phi</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_random_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the random state (private use).</span>

<span class="sd">        For the RSequence sampler, it also resets the sequence index and the sequence start.</span>

<span class="sd">        Args:</span>
<span class="sd">            random_state: the random seed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_set_random_state</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the index of the sequence.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sequence_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span>
            <span class="n">_MIN_SEQUENCE_START_INDEX</span><span class="p">,</span>
            <span class="n">_MAX_SEQUENCE_START_INDEX</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sequence_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">search_space</span><span class="p">:</span> <span class="n">SearchSpace</span><span class="p">,</span>
        <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>  <span class="c1"># noqa: ARG002</span>
        <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>  <span class="c1"># noqa: ARG002</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sample points using the R-sequence.</span>

<span class="sd">        Args:</span>
<span class="sd">            batch_size: the number of samples</span>
<span class="sd">            search_space: an object containing the details of the parameter search space</span>
<span class="sd">            existing_points: the parameters already sampled (not used)</span>
<span class="sd">            existing_losses: the loss corresponding to the sampled parameters (not used)</span>

<span class="sd">        Returns:</span>
<span class="sd">            the parameter sampled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unit_cube_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r_sequence</span><span class="p">(</span>
            <span class="n">batch_size</span><span class="p">,</span>
            <span class="n">search_space</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">p_bounds</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_space</span><span class="o">.</span><span class="n">parameters_bounds</span>
        <span class="n">sampled_points</span> <span class="o">=</span> <span class="n">p_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">unit_cube_points</span> <span class="o">*</span> <span class="p">(</span><span class="n">p_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">digitize_data</span><span class="p">(</span><span class="n">sampled_points</span><span class="p">,</span> <span class="n">search_space</span><span class="o">.</span><span class="n">param_grid</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_r_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the R-sequence (http://extremelearning.com.au/unreasonable-effectiveness-of-quasirandom-sequences/).</span>

<span class="sd">        Args:</span>
<span class="sd">            nb_samples: number of points to sample</span>
<span class="sd">            dims: the number of dimensions</span>

<span class="sd">        Returns:</span>
<span class="sd">            Set of params uniformly placed in d-dimensional unit cube.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_phi</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span>
        <span class="n">alpha</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dims</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">end_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequence_index</span> <span class="o">+</span> <span class="n">nb_samples</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sequence_index</span><span class="p">,</span> <span class="n">end_index</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sequence_start</span> <span class="o">+</span> <span class="n">indexes</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span> <span class="o">%</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sequence_index</span> <span class="o">=</span> <span class="n">end_index</span>
        <span class="k">return</span> <span class="n">points</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.r_sequence.RSequenceSampler.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_deduplication_passes</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Initialize the sampler.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>batch_size</code></td>
        <td><code>int</code></td>
        <td><p>the number of points sampled every time the sampler is called</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>random_state</code></td>
        <td><code>int | None</code></td>
        <td><p>the random state of the sampler, fixing this number the sampler behaves deterministically</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_deduplication_passes</code></td>
        <td><code>int</code></td>
        <td><p>(non-negative integer) the maximum number of deduplication passes that are made
after every batch sampling. Default: 0, i.e. no deduplication happens.</p></td>
        <td><code>5</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/r_sequence.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_deduplication_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the sampler.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch_size: the number of points sampled every time the sampler is called</span>
<span class="sd">        random_state: the random state of the sampler, fixing this number the sampler behaves deterministically</span>
<span class="sd">        max_deduplication_passes: (non-negative integer) the maximum number of deduplication passes that are made</span>
<span class="sd">            after every batch sampling. Default: 0, i.e. no deduplication happens.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">random_state</span><span class="p">,</span> <span class="n">max_deduplication_passes</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_sequence_index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sequence_start</span><span class="p">:</span> <span class="nb">float</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.r_sequence.RSequenceSampler.compute_phi" class="doc doc-heading">
<code class="highlight language-python"><span class="n">compute_phi</span><span class="p">(</span><span class="n">nb_dims</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Get an approximation of phi^nb_dims.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>nb_dims</code></td>
        <td><code>int</code></td>
        <td><p>the number of dimensions.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>float</code></td>
      <td><p>phi^nb_dims</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/r_sequence.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_phi</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nb_dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get an approximation of phi^nb_dims.</span>

<span class="sd">    Args:</span>
<span class="sd">        nb_dims: the number of dimensions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        phi^nb_dims</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_arg</span><span class="p">(</span><span class="n">nb_dims</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;nb_dims should be greater than 0, got </span><span class="si">{</span><span class="n">nb_dims</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">phi</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="n">old_phi</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">while</span> <span class="n">old_phi</span> <span class="o">!=</span> <span class="n">phi</span><span class="p">:</span>
        <span class="n">old_phi</span> <span class="o">=</span> <span class="n">phi</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">phi</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">nb_dims</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">phi</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.r_sequence.RSequenceSampler.sample_batch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sample_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">search_space</span><span class="p">,</span> <span class="n">existing_points</span><span class="p">,</span> <span class="n">existing_losses</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Sample points using the R-sequence.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>batch_size</code></td>
        <td><code>int</code></td>
        <td><p>the number of samples</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>search_space</code></td>
        <td><code>SearchSpace</code></td>
        <td><p>an object containing the details of the parameter search space</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>existing_points</code></td>
        <td><code>NDArray[np.float64]</code></td>
        <td><p>the parameters already sampled (not used)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>existing_losses</code></td>
        <td><code>NDArray[np.float64]</code></td>
        <td><p>the loss corresponding to the sampled parameters (not used)</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>NDArray[np.float64]</code></td>
      <td><p>the parameter sampled</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/r_sequence.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">SearchSpace</span><span class="p">,</span>
    <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>  <span class="c1"># noqa: ARG002</span>
    <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>  <span class="c1"># noqa: ARG002</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample points using the R-sequence.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch_size: the number of samples</span>
<span class="sd">        search_space: an object containing the details of the parameter search space</span>
<span class="sd">        existing_points: the parameters already sampled (not used)</span>
<span class="sd">        existing_losses: the loss corresponding to the sampled parameters (not used)</span>

<span class="sd">    Returns:</span>
<span class="sd">        the parameter sampled</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit_cube_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r_sequence</span><span class="p">(</span>
        <span class="n">batch_size</span><span class="p">,</span>
        <span class="n">search_space</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">p_bounds</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_space</span><span class="o">.</span><span class="n">parameters_bounds</span>
    <span class="n">sampled_points</span> <span class="o">=</span> <span class="n">p_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">unit_cube_points</span> <span class="o">*</span> <span class="p">(</span><span class="n">p_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">digitize_data</span><span class="p">(</span><span class="n">sampled_points</span><span class="p">,</span> <span class="n">search_space</span><span class="o">.</span><span class="n">param_grid</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">

<a id="black_it.samplers.best_batch.BestBatchSampler"></a>
    <div class="doc doc-contents first">

      <p>This class implements the best-batch sampler.</p>
<p>The sampler is a very essential type of genetic algorithm that takes the parameters corresponding
  to the current lowest loss values and perturbs them slightly in a purely random fashion.
The sampler first chooses the total number of coordinates to perturb via a beta-binomial distribution
  BetaBin(dims, a, b) --where dims is the total number of dimensions in the search space --, it then selects
  that many coordinate randomly, and perturbs them uniformly within the range specified by 'perturbation_range'.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/best_batch.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BestBatchSampler</span><span class="p">(</span><span class="n">BaseSampler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class implements the best-batch sampler.</span>

<span class="sd">    The sampler is a very essential type of genetic algorithm that takes the parameters corresponding</span>
<span class="sd">      to the current lowest loss values and perturbs them slightly in a purely random fashion.</span>
<span class="sd">    The sampler first chooses the total number of coordinates to perturb via a beta-binomial distribution</span>
<span class="sd">      BetaBin(dims, a, b) --where dims is the total number of dimensions in the search space --, it then selects</span>
<span class="sd">      that many coordinate randomly, and perturbs them uniformly within the range specified by &#39;perturbation_range&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_deduplication_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">a</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span>
        <span class="n">b</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">perturbation_range</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the sampler.</span>

<span class="sd">        Args:</span>
<span class="sd">            batch_size: the number of points sampled every time the sampler is called</span>
<span class="sd">            random_state: the random state of the sampler, fixing this number the sampler behaves deterministically</span>
<span class="sd">            max_deduplication_passes: the maximum number of deduplication passes that are made</span>
<span class="sd">            a: the a parameter of the beta-binomial distribution</span>
<span class="sd">            b: the b parameter of the beta-binomial distribution</span>
<span class="sd">            perturbation_range: the range of the perturbation applied. The actual perturbation will be in the range</span>
<span class="sd">                plus/minus the perturbation_range times the precision of the specific parameter coordinate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_assert</span><span class="p">(</span>
            <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;&#39;a&#39; should be greater than zero&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">_assert</span><span class="p">(</span>
            <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;&#39;b&#39; should be greater than zero&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">_assert</span><span class="p">(</span>
            <span class="n">perturbation_range</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;&#39;perturbation_range&#39; should be greater than one&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">random_state</span><span class="p">,</span> <span class="n">max_deduplication_passes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">perturbation_range</span> <span class="o">=</span> <span class="n">perturbation_range</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">search_space</span><span class="p">:</span> <span class="n">SearchSpace</span><span class="p">,</span>
        <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sample from the search space using a genetic algorithm.</span>

<span class="sd">        Args:</span>
<span class="sd">            batch_size: the number of points to sample</span>
<span class="sd">            search_space: an object containing the details of the parameter search space</span>
<span class="sd">            existing_points: the parameters already sampled</span>
<span class="sd">            existing_losses: the loss corresponding to the sampled parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            the sampled parameters (an array of shape `(self.batch_size, search_space.dims)`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_points</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">batch_size</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;best-batch sampler requires a number of existing points &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;which is at least the batch size </span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">existing_points</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="n">msg</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># sort existing params</span>
        <span class="n">candidate_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">existing_points</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">existing_losses</span><span class="p">)][:</span><span class="n">batch_size</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">candidate_point_indexes</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">sampled_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
            <span class="n">candidate_points</span><span class="p">[</span><span class="n">candidate_point_indexes</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">beta_binom_rv</span> <span class="o">=</span> <span class="n">betabinom</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">search_space</span><span class="o">.</span><span class="n">dims</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
        <span class="n">beta_binom_rv</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span>

        <span class="k">for</span> <span class="n">sampled_point</span> <span class="ow">in</span> <span class="n">sampled_points</span><span class="p">:</span>
            <span class="n">num_shocks</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta_binom_rv</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">params_shocked</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
                <span class="n">search_space</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
                <span class="nb">tuple</span><span class="p">(</span><span class="n">num_shocks</span><span class="p">),</span>
                <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">params_shocked</span><span class="p">:</span>
                <span class="n">shock_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span>
                    <span class="mi">1</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">perturbation_range</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">shock_sign</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="n">delta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">search_space</span><span class="o">.</span><span class="n">parameters_precision</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">shift</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">shock_sign</span> <span class="o">*</span> <span class="n">shock_size</span>
                <span class="n">sampled_point</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">shift</span>

                <span class="n">sampled_point</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
                    <span class="n">sampled_point</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                    <span class="n">search_space</span><span class="o">.</span><span class="n">parameters_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                    <span class="n">search_space</span><span class="o">.</span><span class="n">parameters_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">sampled_points</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.best_batch.BestBatchSampler.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_deduplication_passes</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">perturbation_range</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Initialize the sampler.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>batch_size</code></td>
        <td><code>int</code></td>
        <td><p>the number of points sampled every time the sampler is called</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>random_state</code></td>
        <td><code>int | None</code></td>
        <td><p>the random state of the sampler, fixing this number the sampler behaves deterministically</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_deduplication_passes</code></td>
        <td><code>int</code></td>
        <td><p>the maximum number of deduplication passes that are made</p></td>
        <td><code>5</code></td>
      </tr>
      <tr>
        <td><code>a</code></td>
        <td><code>float</code></td>
        <td><p>the a parameter of the beta-binomial distribution</p></td>
        <td><code>3.0</code></td>
      </tr>
      <tr>
        <td><code>b</code></td>
        <td><code>float</code></td>
        <td><p>the b parameter of the beta-binomial distribution</p></td>
        <td><code>1.0</code></td>
      </tr>
      <tr>
        <td><code>perturbation_range</code></td>
        <td><code>int</code></td>
        <td><p>the range of the perturbation applied. The actual perturbation will be in the range
plus/minus the perturbation_range times the precision of the specific parameter coordinate</p></td>
        <td><code>6</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/best_batch.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_deduplication_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">perturbation_range</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the sampler.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch_size: the number of points sampled every time the sampler is called</span>
<span class="sd">        random_state: the random state of the sampler, fixing this number the sampler behaves deterministically</span>
<span class="sd">        max_deduplication_passes: the maximum number of deduplication passes that are made</span>
<span class="sd">        a: the a parameter of the beta-binomial distribution</span>
<span class="sd">        b: the b parameter of the beta-binomial distribution</span>
<span class="sd">        perturbation_range: the range of the perturbation applied. The actual perturbation will be in the range</span>
<span class="sd">            plus/minus the perturbation_range times the precision of the specific parameter coordinate</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_assert</span><span class="p">(</span>
        <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;&#39;a&#39; should be greater than zero&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">_assert</span><span class="p">(</span>
        <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;&#39;b&#39; should be greater than zero&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">_assert</span><span class="p">(</span>
        <span class="n">perturbation_range</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;&#39;perturbation_range&#39; should be greater than one&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">random_state</span><span class="p">,</span> <span class="n">max_deduplication_passes</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">perturbation_range</span> <span class="o">=</span> <span class="n">perturbation_range</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.best_batch.BestBatchSampler.sample_batch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sample_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">search_space</span><span class="p">,</span> <span class="n">existing_points</span><span class="p">,</span> <span class="n">existing_losses</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Sample from the search space using a genetic algorithm.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>batch_size</code></td>
        <td><code>int</code></td>
        <td><p>the number of points to sample</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>search_space</code></td>
        <td><code>SearchSpace</code></td>
        <td><p>an object containing the details of the parameter search space</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>existing_points</code></td>
        <td><code>NDArray[np.float64]</code></td>
        <td><p>the parameters already sampled</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>existing_losses</code></td>
        <td><code>NDArray[np.float64]</code></td>
        <td><p>the loss corresponding to the sampled parameters</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>NDArray[np.float64]</code></td>
      <td><p>the sampled parameters (an array of shape <code>(self.batch_size, search_space.dims)</code>)</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/best_batch.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">SearchSpace</span><span class="p">,</span>
    <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample from the search space using a genetic algorithm.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch_size: the number of points to sample</span>
<span class="sd">        search_space: an object containing the details of the parameter search space</span>
<span class="sd">        existing_points: the parameters already sampled</span>
<span class="sd">        existing_losses: the loss corresponding to the sampled parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        the sampled parameters (an array of shape `(self.batch_size, search_space.dims)`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_points</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">batch_size</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;best-batch sampler requires a number of existing points &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;which is at least the batch size </span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">existing_points</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="n">msg</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># sort existing params</span>
    <span class="n">candidate_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">existing_points</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">existing_losses</span><span class="p">)][:</span><span class="n">batch_size</span><span class="p">,</span> <span class="p">:]</span>

    <span class="n">candidate_point_indexes</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sampled_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
        <span class="n">candidate_points</span><span class="p">[</span><span class="n">candidate_point_indexes</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">beta_binom_rv</span> <span class="o">=</span> <span class="n">betabinom</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">search_space</span><span class="o">.</span><span class="n">dims</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
    <span class="n">beta_binom_rv</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span>

    <span class="k">for</span> <span class="n">sampled_point</span> <span class="ow">in</span> <span class="n">sampled_points</span><span class="p">:</span>
        <span class="n">num_shocks</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta_binom_rv</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">params_shocked</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
            <span class="n">search_space</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="n">num_shocks</span><span class="p">),</span>
            <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">params_shocked</span><span class="p">:</span>
            <span class="n">shock_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">perturbation_range</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">shock_sign</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="n">delta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">search_space</span><span class="o">.</span><span class="n">parameters_precision</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">shift</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">shock_sign</span> <span class="o">*</span> <span class="n">shock_size</span>
            <span class="n">sampled_point</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">shift</span>

            <span class="n">sampled_point</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
                <span class="n">sampled_point</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                <span class="n">search_space</span><span class="o">.</span><span class="n">parameters_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                <span class="n">search_space</span><span class="o">.</span><span class="n">parameters_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">sampled_points</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">

<a id="black_it.samplers.gaussian_process.GaussianProcessSampler"></a>
    <div class="doc doc-contents first">

      <p>This class implements the Gaussian process-based sampler.</p>
<p>In particular, the sampling is based on a Gaussian Process interpolation of the loss function.</p>
<p>Note: this class is a wrapper of the GaussianProcessRegressor model of the scikit-learn package.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/gaussian_process.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GaussianProcessSampler</span><span class="p">(</span><span class="n">MLSurrogateSampler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class implements the Gaussian process-based sampler.</span>

<span class="sd">    In particular, the sampling is based on a Gaussian Process interpolation of the loss function.</span>

<span class="sd">    Note: this class is a wrapper of the GaussianProcessRegressor model of the scikit-learn package.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_deduplication_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">candidate_pool_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">optimize_restarts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">acquisition</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;expected_improvement&quot;</span><span class="p">,</span>
        <span class="n">jitter</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the sampler.</span>

<span class="sd">        Args:</span>
<span class="sd">            batch_size: the number of points sampled every time the sampler is called</span>
<span class="sd">            random_state: the random state of the sampler, fixing this number the sampler behaves deterministically</span>
<span class="sd">            max_deduplication_passes: the maximum number of deduplication passes that are made</span>
<span class="sd">            candidate_pool_size: number of randomly sampled points on which the random forest predictions are evaluated</span>
<span class="sd">            optimize_restarts: number of independent random trials of the optimization of the GP hyperparameters</span>
<span class="sd">            acquisition: type of acquisition function, it can be &#39;expected_improvement&#39; of simply &#39;mean&#39;</span>
<span class="sd">            jitter: positive value to make the &quot;expected_improvement&quot; acquisition more explorative.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_acquisition</span><span class="p">(</span><span class="n">acquisition</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">batch_size</span><span class="p">,</span>
            <span class="n">random_state</span><span class="p">,</span>
            <span class="n">max_deduplication_passes</span><span class="p">,</span>
            <span class="n">candidate_pool_size</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimize_restarts</span> <span class="o">=</span> <span class="n">optimize_restarts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acquisition</span> <span class="o">=</span> <span class="n">acquisition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter</span> <span class="o">=</span> <span class="n">jitter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gpmodel</span><span class="p">:</span> <span class="n">GaussianProcessRegressor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fmin</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_acquisition</span><span class="p">(</span><span class="n">acquisition</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that the required acquisition is among the supported ones.</span>

<span class="sd">        Args:</span>
<span class="sd">            acquisition: the acquisition provided as input of the constructor.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if the provided acquisition type is not among the allowed ones.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_AcquisitionTypes</span><span class="p">(</span><span class="n">acquisition</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;expected one of the following acquisition types: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">_AcquisitionTypes</span><span class="p">))</span><span class="si">}</span><span class="s2">], got </span><span class="si">{</span><span class="n">acquisition</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="n">msg</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># noqa: N803</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit a gaussian process surrogate model.&quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">_BIG_DATASET_SIZE_WARNING_THRESHOLD</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>  <span class="c1"># noqa: B028</span>
                <span class="s2">&quot;Standard GP evaluations can be expensive for large datasets, consider implementing a sparse GP&quot;</span><span class="p">,</span>
                <span class="ne">RuntimeWarning</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># initialize GP class from scikit-learn with a Matern kernel</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">kernels</span><span class="o">.</span><span class="n">Matern</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">length_scale_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">),</span> <span class="n">nu</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>

        <span class="n">noise_var</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">var</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.01</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_gpmodel</span> <span class="o">=</span> <span class="n">GaussianProcessRegressor</span><span class="p">(</span>
            <span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">noise_var</span><span class="p">,</span>
            <span class="n">n_restarts_optimizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimize_restarts</span><span class="p">,</span>
            <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;fmin_l_bfgs_b&quot;</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_random_seed</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_gpmodel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># store minimum</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquisition</span> <span class="o">==</span> <span class="s2">&quot;expected_improvement&quot;</span><span class="p">:</span>
            <span class="n">m</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_mean_std</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>  <span class="c1"># noqa: N803</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Predict using a gaussian process surrogate model.&quot;&quot;&quot;</span>
        <span class="c1"># predict mean or expected improvement on the full sample set</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquisition</span> <span class="o">==</span> <span class="n">_AcquisitionTypes</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="c1"># minus sign needed for subsequent sorting</span>
            <span class="n">candidates_score</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_predict_EI</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">jitter</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># acquisition is &quot;mean&quot;</span>
            <span class="n">candidates_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_mean_std</span><span class="p">(</span><span class="n">X</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">candidates_score</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_predict_mean_std</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">X</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>  <span class="c1"># noqa: N803</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Predict mean and standard deviation of a fitted GP.</span>

<span class="sd">        Args:</span>
<span class="sd">            X: the points on which the predictions should be performed</span>

<span class="sd">        Returns:</span>
<span class="sd">            The pair (mean, std).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gpmodel</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;GaussianProcessRegressor&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gpmodel</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span> <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">X</span>  <span class="c1"># noqa: N806</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">gpmodel</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">return_std</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_cov</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_predict_EI</span><span class="p">(</span>  <span class="c1"># noqa: N802</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">X</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>  <span class="c1"># noqa: N803</span>
        <span class="n">jitter</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the Expected Improvement per unit of cost.</span>

<span class="sd">        Args:</span>
<span class="sd">            X:  the points on which the predictions should be performed</span>
<span class="sd">            jitter: positive value to make the acquisition more explorative.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the expected improvement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_mean_std</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="n">fmin</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmin</span><span class="p">)</span>

        <span class="n">phi</span><span class="p">,</span> <span class="n">Phi</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_quantiles</span><span class="p">(</span><span class="n">jitter</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>  <span class="c1"># noqa: N806</span>

        <span class="k">return</span> <span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span> <span class="o">*</span> <span class="n">Phi</span> <span class="o">+</span> <span class="n">phi</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_quantiles</span><span class="p">(</span>
        <span class="n">acquisition_par</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">fmin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">m</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">s</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Quantiles of the Gaussian distribution useful to determine the acquisition function values.</span>

<span class="sd">        Args:</span>
<span class="sd">            acquisition_par: parameter of the acquisition function</span>
<span class="sd">            fmin: current minimum.</span>
<span class="sd">            m: vector of means.</span>
<span class="sd">            s: vector of standard deviations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the quantiles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># remove values of variance that are too small</span>
        <span class="n">s</span><span class="p">[</span><span class="n">s</span> <span class="o">&lt;</span> <span class="n">_SMALL_VARIANCE_VALUES</span><span class="p">]</span> <span class="o">=</span> <span class="n">_SMALL_VARIANCE_VALUES</span>

        <span class="n">u</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fmin</span> <span class="o">-</span> <span class="n">m</span> <span class="o">-</span> <span class="n">acquisition_par</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span>
        <span class="n">phi</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">Phi</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">erfc</span><span class="p">(</span><span class="o">-</span><span class="n">u</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>  <span class="c1"># noqa: N806</span>

        <span class="k">return</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Phi</span><span class="p">,</span> <span class="n">u</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.gaussian_process.GaussianProcessSampler.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_deduplication_passes</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">candidate_pool_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optimize_restarts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">acquisition</span><span class="o">=</span><span class="s1">&#39;expected_improvement&#39;</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Initialize the sampler.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>batch_size</code></td>
        <td><code>int</code></td>
        <td><p>the number of points sampled every time the sampler is called</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>random_state</code></td>
        <td><code>int | None</code></td>
        <td><p>the random state of the sampler, fixing this number the sampler behaves deterministically</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_deduplication_passes</code></td>
        <td><code>int</code></td>
        <td><p>the maximum number of deduplication passes that are made</p></td>
        <td><code>5</code></td>
      </tr>
      <tr>
        <td><code>candidate_pool_size</code></td>
        <td><code>int | None</code></td>
        <td><p>number of randomly sampled points on which the random forest predictions are evaluated</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>optimize_restarts</code></td>
        <td><code>int</code></td>
        <td><p>number of independent random trials of the optimization of the GP hyperparameters</p></td>
        <td><code>5</code></td>
      </tr>
      <tr>
        <td><code>acquisition</code></td>
        <td><code>str</code></td>
        <td><p>type of acquisition function, it can be 'expected_improvement' of simply 'mean'</p></td>
        <td><code>&#39;expected_improvement&#39;</code></td>
      </tr>
      <tr>
        <td><code>jitter</code></td>
        <td><code>float</code></td>
        <td><p>positive value to make the "expected_improvement" acquisition more explorative.</p></td>
        <td><code>0.1</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/gaussian_process.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_deduplication_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">candidate_pool_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">optimize_restarts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">acquisition</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;expected_improvement&quot;</span><span class="p">,</span>
    <span class="n">jitter</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the sampler.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch_size: the number of points sampled every time the sampler is called</span>
<span class="sd">        random_state: the random state of the sampler, fixing this number the sampler behaves deterministically</span>
<span class="sd">        max_deduplication_passes: the maximum number of deduplication passes that are made</span>
<span class="sd">        candidate_pool_size: number of randomly sampled points on which the random forest predictions are evaluated</span>
<span class="sd">        optimize_restarts: number of independent random trials of the optimization of the GP hyperparameters</span>
<span class="sd">        acquisition: type of acquisition function, it can be &#39;expected_improvement&#39; of simply &#39;mean&#39;</span>
<span class="sd">        jitter: positive value to make the &quot;expected_improvement&quot; acquisition more explorative.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_acquisition</span><span class="p">(</span><span class="n">acquisition</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">batch_size</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">,</span>
        <span class="n">max_deduplication_passes</span><span class="p">,</span>
        <span class="n">candidate_pool_size</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">optimize_restarts</span> <span class="o">=</span> <span class="n">optimize_restarts</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">acquisition</span> <span class="o">=</span> <span class="n">acquisition</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">jitter</span> <span class="o">=</span> <span class="n">jitter</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_gpmodel</span><span class="p">:</span> <span class="n">GaussianProcessRegressor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fmin</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.gaussian_process.GaussianProcessSampler.fit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Fit a gaussian process surrogate model.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/gaussian_process.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># noqa: N803</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit a gaussian process surrogate model.&quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">_BIG_DATASET_SIZE_WARNING_THRESHOLD</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>  <span class="c1"># noqa: B028</span>
            <span class="s2">&quot;Standard GP evaluations can be expensive for large datasets, consider implementing a sparse GP&quot;</span><span class="p">,</span>
            <span class="ne">RuntimeWarning</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># initialize GP class from scikit-learn with a Matern kernel</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">kernels</span><span class="o">.</span><span class="n">Matern</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">length_scale_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">),</span> <span class="n">nu</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>

    <span class="n">noise_var</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">var</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.01</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_gpmodel</span> <span class="o">=</span> <span class="n">GaussianProcessRegressor</span><span class="p">(</span>
        <span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">noise_var</span><span class="p">,</span>
        <span class="n">n_restarts_optimizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimize_restarts</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;fmin_l_bfgs_b&quot;</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_random_seed</span><span class="p">(),</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_gpmodel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># store minimum</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquisition</span> <span class="o">==</span> <span class="s2">&quot;expected_improvement&quot;</span><span class="p">:</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_mean_std</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.gaussian_process.GaussianProcessSampler.get_quantiles" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_quantiles</span><span class="p">(</span><span class="n">acquisition_par</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Quantiles of the Gaussian distribution useful to determine the acquisition function values.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>acquisition_par</code></td>
        <td><code>float</code></td>
        <td><p>parameter of the acquisition function</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>fmin</code></td>
        <td><code>float</code></td>
        <td><p>current minimum.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>m</code></td>
        <td><code>NDArray[np.float64]</code></td>
        <td><p>vector of means.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>s</code></td>
        <td><code>NDArray[np.float64]</code></td>
        <td><p>vector of standard deviations.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>tuple[NDArray[np.float64], NDArray[np.float64], NDArray[np.float64]]</code></td>
      <td><p>the quantiles.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/gaussian_process.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_quantiles</span><span class="p">(</span>
    <span class="n">acquisition_par</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">fmin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">m</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">s</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Quantiles of the Gaussian distribution useful to determine the acquisition function values.</span>

<span class="sd">    Args:</span>
<span class="sd">        acquisition_par: parameter of the acquisition function</span>
<span class="sd">        fmin: current minimum.</span>
<span class="sd">        m: vector of means.</span>
<span class="sd">        s: vector of standard deviations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        the quantiles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># remove values of variance that are too small</span>
    <span class="n">s</span><span class="p">[</span><span class="n">s</span> <span class="o">&lt;</span> <span class="n">_SMALL_VARIANCE_VALUES</span><span class="p">]</span> <span class="o">=</span> <span class="n">_SMALL_VARIANCE_VALUES</span>

    <span class="n">u</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fmin</span> <span class="o">-</span> <span class="n">m</span> <span class="o">-</span> <span class="n">acquisition_par</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span>
    <span class="n">phi</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">Phi</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">erfc</span><span class="p">(</span><span class="o">-</span><span class="n">u</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>  <span class="c1"># noqa: N806</span>

    <span class="k">return</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Phi</span><span class="p">,</span> <span class="n">u</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.gaussian_process.GaussianProcessSampler.predict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Predict using a gaussian process surrogate model.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/gaussian_process.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>  <span class="c1"># noqa: N803</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Predict using a gaussian process surrogate model.&quot;&quot;&quot;</span>
    <span class="c1"># predict mean or expected improvement on the full sample set</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquisition</span> <span class="o">==</span> <span class="n">_AcquisitionTypes</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="c1"># minus sign needed for subsequent sorting</span>
        <span class="n">candidates_score</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_predict_EI</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">jitter</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># acquisition is &quot;mean&quot;</span>
        <span class="n">candidates_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_mean_std</span><span class="p">(</span><span class="n">X</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">candidates_score</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">

<a id="black_it.samplers.random_forest.RandomForestSampler"></a>
    <div class="doc doc-contents first">

      <p>This class implements random forest sampling.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/random_forest.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RandomForestSampler</span><span class="p">(</span><span class="n">MLSurrogateSampler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class implements random forest sampling.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_deduplication_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">candidate_pool_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">n_estimators</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
        <span class="n">criterion</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gini&quot;</span><span class="p">,</span>
        <span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Random forest sampling.</span>

<span class="sd">        Note: this class makes use of sklearn.ensemble.RandomForestClassifier.</span>

<span class="sd">        Args:</span>
<span class="sd">            batch_size: the number of points sampled every time the sampler is called</span>
<span class="sd">            random_state: the random state of the sampler, fixing this number the sampler behaves deterministically</span>
<span class="sd">            max_deduplication_passes: the maximum number of deduplication passes</span>
<span class="sd">            candidate_pool_size: number of randomly sampled points on which the random forest predictions are evaluated</span>
<span class="sd">            n_estimators: number of trees in the forest</span>
<span class="sd">            criterion: the function to measure the quality of a split.</span>
<span class="sd">            n_classes: the number of classes used in the random forest. The classes are selected as the quantiles</span>
<span class="sd">                of the distribution of loss values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_assert</span><span class="p">(</span>
            <span class="n">n_classes</span> <span class="o">&gt;</span> <span class="n">_MIN_RF_CLASSES</span><span class="p">,</span>
            <span class="s2">&quot;&#39;n_classes&#39; should be at least 2 to provide meaningful results&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">batch_size</span><span class="p">,</span>
            <span class="n">random_state</span><span class="p">,</span>
            <span class="n">max_deduplication_passes</span><span class="p">,</span>
            <span class="n">candidate_pool_size</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_n_estimators</span> <span class="o">=</span> <span class="n">n_estimators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_criterion</span> <span class="o">=</span> <span class="n">criterion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_classes</span> <span class="o">=</span> <span class="n">n_classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="p">:</span> <span class="n">RandomForestClassifier</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">n_estimators</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the number of estimators.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_estimators</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the criterion.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_criterion</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">n_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the number of classes.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_classes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># noqa: N803</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit a random forest surrogate model.&quot;&quot;&quot;</span>
        <span class="c1"># Train surrogate</span>

        <span class="p">(</span>
            <span class="n">X</span><span class="p">,</span>  <span class="c1"># noqa: N806</span>
            <span class="n">y_cat</span><span class="p">,</span>
            <span class="n">_existing_points_quantiles</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_data_for_classifier</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_classes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span>
            <span class="n">n_estimators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_estimators</span><span class="p">,</span>
            <span class="n">criterion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">criterion</span><span class="p">,</span>
            <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_random_seed</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y_cat</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>  <span class="c1"># noqa: N803</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Predict using a random forest surrogate model.&quot;&quot;&quot;</span>
        <span class="c1"># Predict quantiles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;RandomForestClassifier&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="p">)</span>
        <span class="n">predicted_points_quantiles</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">predicted_points_quantiles</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_data_for_classifier</span><span class="p">(</span>
        <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">num_bins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare data for the classifier.</span>

<span class="sd">        Args:</span>
<span class="sd">            existing_points: the parameters already sampled</span>
<span class="sd">            existing_losses: the loss corresponding to the sampled parameters</span>
<span class="sd">            num_bins: the number of bins</span>

<span class="sd">        Returns:</span>
<span class="sd">            A triple (x, y, quantiles), where</span>
<span class="sd">                - x is the vector of training data</span>
<span class="sd">                - y is the vector of targets</span>
<span class="sd">                - the quantiles</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">existing_points</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">existing_losses</span>

        <span class="n">cutoffs</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">quantiles</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bins</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">quantiles</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">cutoffs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>

        <span class="n">quantiles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="n">y_cat</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quantiles</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">y_cat</span> <span class="o">=</span> <span class="n">y_cat</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_cat</span><span class="p">,</span> <span class="n">quantiles</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h2 id="black_it.samplers.random_forest.RandomForestSampler.criterion" class="doc doc-heading">
<code class="highlight language-python"><span class="n">criterion</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Get the criterion.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h2 id="black_it.samplers.random_forest.RandomForestSampler.n_classes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Get the number of classes.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h2 id="black_it.samplers.random_forest.RandomForestSampler.n_estimators" class="doc doc-heading">
<code class="highlight language-python"><span class="n">n_estimators</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Get the number of estimators.</p>
    </div>

  </div>






  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.random_forest.RandomForestSampler.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_deduplication_passes</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">candidate_pool_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Random forest sampling.</p>
<p>Note: this class makes use of sklearn.ensemble.RandomForestClassifier.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>batch_size</code></td>
        <td><code>int</code></td>
        <td><p>the number of points sampled every time the sampler is called</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>random_state</code></td>
        <td><code>int | None</code></td>
        <td><p>the random state of the sampler, fixing this number the sampler behaves deterministically</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_deduplication_passes</code></td>
        <td><code>int</code></td>
        <td><p>the maximum number of deduplication passes</p></td>
        <td><code>5</code></td>
      </tr>
      <tr>
        <td><code>candidate_pool_size</code></td>
        <td><code>int | None</code></td>
        <td><p>number of randomly sampled points on which the random forest predictions are evaluated</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>n_estimators</code></td>
        <td><code>int</code></td>
        <td><p>number of trees in the forest</p></td>
        <td><code>500</code></td>
      </tr>
      <tr>
        <td><code>criterion</code></td>
        <td><code>str</code></td>
        <td><p>the function to measure the quality of a split.</p></td>
        <td><code>&#39;gini&#39;</code></td>
      </tr>
      <tr>
        <td><code>n_classes</code></td>
        <td><code>int</code></td>
        <td><p>the number of classes used in the random forest. The classes are selected as the quantiles
of the distribution of loss values.</p></td>
        <td><code>10</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/random_forest.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_deduplication_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">candidate_pool_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_estimators</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">criterion</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gini&quot;</span><span class="p">,</span>
    <span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Random forest sampling.</span>

<span class="sd">    Note: this class makes use of sklearn.ensemble.RandomForestClassifier.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch_size: the number of points sampled every time the sampler is called</span>
<span class="sd">        random_state: the random state of the sampler, fixing this number the sampler behaves deterministically</span>
<span class="sd">        max_deduplication_passes: the maximum number of deduplication passes</span>
<span class="sd">        candidate_pool_size: number of randomly sampled points on which the random forest predictions are evaluated</span>
<span class="sd">        n_estimators: number of trees in the forest</span>
<span class="sd">        criterion: the function to measure the quality of a split.</span>
<span class="sd">        n_classes: the number of classes used in the random forest. The classes are selected as the quantiles</span>
<span class="sd">            of the distribution of loss values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_assert</span><span class="p">(</span>
        <span class="n">n_classes</span> <span class="o">&gt;</span> <span class="n">_MIN_RF_CLASSES</span><span class="p">,</span>
        <span class="s2">&quot;&#39;n_classes&#39; should be at least 2 to provide meaningful results&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">batch_size</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">,</span>
        <span class="n">max_deduplication_passes</span><span class="p">,</span>
        <span class="n">candidate_pool_size</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_n_estimators</span> <span class="o">=</span> <span class="n">n_estimators</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_criterion</span> <span class="o">=</span> <span class="n">criterion</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_n_classes</span> <span class="o">=</span> <span class="n">n_classes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="p">:</span> <span class="n">RandomForestClassifier</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.random_forest.RandomForestSampler.fit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Fit a random forest surrogate model.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/random_forest.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># noqa: N803</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit a random forest surrogate model.&quot;&quot;&quot;</span>
    <span class="c1"># Train surrogate</span>

    <span class="p">(</span>
        <span class="n">X</span><span class="p">,</span>  <span class="c1"># noqa: N806</span>
        <span class="n">y_cat</span><span class="p">,</span>
        <span class="n">_existing_points_quantiles</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_data_for_classifier</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_classes</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_estimators</span><span class="p">,</span>
        <span class="n">criterion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">criterion</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_random_seed</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y_cat</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.random_forest.RandomForestSampler.predict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Predict using a random forest surrogate model.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/random_forest.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>  <span class="c1"># noqa: N803</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Predict using a random forest surrogate model.&quot;&quot;&quot;</span>
    <span class="c1"># Predict quantiles</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;RandomForestClassifier&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="p">)</span>
    <span class="n">predicted_points_quantiles</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">predicted_points_quantiles</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.random_forest.RandomForestSampler.prepare_data_for_classifier" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prepare_data_for_classifier</span><span class="p">(</span><span class="n">existing_points</span><span class="p">,</span> <span class="n">existing_losses</span><span class="p">,</span> <span class="n">num_bins</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Prepare data for the classifier.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>existing_points</code></td>
        <td><code>NDArray[np.float64]</code></td>
        <td><p>the parameters already sampled</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>existing_losses</code></td>
        <td><code>NDArray[np.float64]</code></td>
        <td><p>the loss corresponding to the sampled parameters</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>num_bins</code></td>
        <td><code>int</code></td>
        <td><p>the number of bins</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>tuple[NDArray[np.float64], NDArray[np.int64], NDArray[np.float64]]</code></td>
      <td><p>A triple (x, y, quantiles), where
    - x is the vector of training data
    - y is the vector of targets
    - the quantiles</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/random_forest.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">prepare_data_for_classifier</span><span class="p">(</span>
    <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">num_bins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prepare data for the classifier.</span>

<span class="sd">    Args:</span>
<span class="sd">        existing_points: the parameters already sampled</span>
<span class="sd">        existing_losses: the loss corresponding to the sampled parameters</span>
<span class="sd">        num_bins: the number of bins</span>

<span class="sd">    Returns:</span>
<span class="sd">        A triple (x, y, quantiles), where</span>
<span class="sd">            - x is the vector of training data</span>
<span class="sd">            - y is the vector of targets</span>
<span class="sd">            - the quantiles</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">existing_points</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">existing_losses</span>

    <span class="n">cutoffs</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">quantiles</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bins</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">quantiles</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">cutoffs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>

    <span class="n">quantiles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="n">y_cat</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quantiles</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">y_cat</span> <span class="o">=</span> <span class="n">y_cat</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_cat</span><span class="p">,</span> <span class="n">quantiles</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">

<a id="black_it.samplers.xgboost.XGBoostSampler"></a>
    <div class="doc doc-contents first">

      <p>This class implements xgboost sampling.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/xgboost.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">XGBoostSampler</span><span class="p">(</span><span class="n">MLSurrogateSampler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class implements xgboost sampling.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>  <span class="c1"># noqa: PLR0913</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_deduplication_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">candidate_pool_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">colsample_bytree</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
        <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">n_estimators</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sampler based on a xgboost surrogate model of the loss function.</span>

<span class="sd">        Note: this class makes use of the xgboost library, for more information on the XGBoost parameters</span>
<span class="sd">            visit https://xgboost.readthedocs.io/en/stable/parameter.html.</span>

<span class="sd">        Args:</span>
<span class="sd">            batch_size: the number of points sampled every time the sampler is called</span>
<span class="sd">            random_state: the random state of the sampler, fixing this number the sampler behaves deterministically</span>
<span class="sd">            max_deduplication_passes: the maximum number of deduplication passes</span>
<span class="sd">            candidate_pool_size: number of randomly sampled points on which the random forest predictions are evaluated</span>
<span class="sd">            colsample_bytree: subsample ratio of columns when constructing each tree</span>
<span class="sd">            learning_rate: the learning rate</span>
<span class="sd">            max_depth: maximum depth of XGBoost trees</span>
<span class="sd">            alpha: L1 regularization term on weights</span>
<span class="sd">            n_estimators: number of estimators</span>

<span class="sd">        References:</span>
<span class="sd">            Lamperti, Roventini, and Sani, &quot;Agent-based model calibration using machine learning surrogates&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">batch_size</span><span class="p">,</span>
            <span class="n">random_state</span><span class="p">,</span>
            <span class="n">max_deduplication_passes</span><span class="p">,</span>
            <span class="n">candidate_pool_size</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_colsample_bytree</span> <span class="o">=</span> <span class="n">colsample_bytree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_depth</span> <span class="o">=</span> <span class="n">max_depth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_estimators</span> <span class="o">=</span> <span class="n">n_estimators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xg_regressor</span><span class="p">:</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">colsample_bytree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the colsample_bytree parameter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colsample_bytree</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">learning_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the learning rate.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_learning_rate</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the maximum tree depth.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_depth</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the alpha regularisation parameter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">n_estimators</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the number of estimators.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_estimators</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_clip_losses</span><span class="p">(</span><span class="n">y</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that loss values fall within the float32 limits needed for XGBoost to work.&quot;&quot;&quot;</span>
        <span class="n">large_floats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">MAX_FLOAT32</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">small_floats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">MIN_FLOAT32</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">large_floats</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">small_floats</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">y</span>

        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>  <span class="c1"># noqa: B028</span>
            <span class="s2">&quot;Found loss values out of float32 limits, clipping them for XGBoost.&quot;</span><span class="p">,</span>
            <span class="ne">RuntimeWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">large_floats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">y</span><span class="p">[</span><span class="n">large_floats</span><span class="p">]</span> <span class="o">=</span> <span class="n">MAX_FLOAT32</span> <span class="o">-</span> <span class="n">EPS_FLOAT32</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">small_floats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">y</span><span class="p">[</span><span class="n">small_floats</span><span class="p">]</span> <span class="o">=</span> <span class="n">MIN_FLOAT32</span> <span class="o">+</span> <span class="n">EPS_FLOAT32</span>

        <span class="k">return</span> <span class="n">y</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># noqa: N803</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit a xgboost surrogate model.&quot;&quot;&quot;</span>
        <span class="c1"># prepare data</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clip_losses</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">DMatrix</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># train surrogate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xg_regressor</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span>
            <span class="n">objective</span><span class="o">=</span><span class="s2">&quot;reg:squarederror&quot;</span><span class="p">,</span>  <span class="c1"># original: objective =&#39;reg:linear&#39;,</span>
            <span class="n">colsample_bytree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colsample_bytree</span><span class="p">,</span>
            <span class="n">learning_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span><span class="p">,</span>
            <span class="n">max_depth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_depth</span><span class="p">,</span>  <span class="c1"># original: 5</span>
            <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">n_estimators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_estimators</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_random_seed</span><span class="p">(),</span>
        <span class="p">)</span>  <span class="c1"># original: 10</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_xg_regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>  <span class="c1"># noqa: N803</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Predict using a xgboost surrogate model.&quot;&quot;&quot;</span>
        <span class="c1"># predict over large pool of candidates</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">DMatrix</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_xg_regressor</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;xgb.XGBRegressor&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xg_regressor</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xg_regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h2 id="black_it.samplers.xgboost.XGBoostSampler.alpha" class="doc doc-heading">
<code class="highlight language-python"><span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Get the alpha regularisation parameter.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h2 id="black_it.samplers.xgboost.XGBoostSampler.colsample_bytree" class="doc doc-heading">
<code class="highlight language-python"><span class="n">colsample_bytree</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Get the colsample_bytree parameter.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h2 id="black_it.samplers.xgboost.XGBoostSampler.learning_rate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Get the learning rate.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h2 id="black_it.samplers.xgboost.XGBoostSampler.max_depth" class="doc doc-heading">
<code class="highlight language-python"><span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Get the maximum tree depth.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h2 id="black_it.samplers.xgboost.XGBoostSampler.n_estimators" class="doc doc-heading">
<code class="highlight language-python"><span class="n">n_estimators</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Get the number of estimators.</p>
    </div>

  </div>






  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.xgboost.XGBoostSampler.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_deduplication_passes</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">candidate_pool_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colsample_bytree</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Sampler based on a xgboost surrogate model of the loss function.</p>
<div class="admonition note">
<p class="admonition-title">this class makes use of the xgboost library, for more information on the XGBoost parameters</p>
<p>visit https://xgboost.readthedocs.io/en/stable/parameter.html.</p>
</div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>batch_size</code></td>
        <td><code>int</code></td>
        <td><p>the number of points sampled every time the sampler is called</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>random_state</code></td>
        <td><code>int | None</code></td>
        <td><p>the random state of the sampler, fixing this number the sampler behaves deterministically</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_deduplication_passes</code></td>
        <td><code>int</code></td>
        <td><p>the maximum number of deduplication passes</p></td>
        <td><code>5</code></td>
      </tr>
      <tr>
        <td><code>candidate_pool_size</code></td>
        <td><code>int | None</code></td>
        <td><p>number of randomly sampled points on which the random forest predictions are evaluated</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>colsample_bytree</code></td>
        <td><code>float</code></td>
        <td><p>subsample ratio of columns when constructing each tree</p></td>
        <td><code>0.3</code></td>
      </tr>
      <tr>
        <td><code>learning_rate</code></td>
        <td><code>float</code></td>
        <td><p>the learning rate</p></td>
        <td><code>0.1</code></td>
      </tr>
      <tr>
        <td><code>max_depth</code></td>
        <td><code>int</code></td>
        <td><p>maximum depth of XGBoost trees</p></td>
        <td><code>5</code></td>
      </tr>
      <tr>
        <td><code>alpha</code></td>
        <td><code>float</code></td>
        <td><p>L1 regularization term on weights</p></td>
        <td><code>1.0</code></td>
      </tr>
      <tr>
        <td><code>n_estimators</code></td>
        <td><code>int</code></td>
        <td><p>number of estimators</p></td>
        <td><code>10</code></td>
      </tr>
  </tbody>
</table>      <div class="admonition references">
<p class="admonition-title">References</p>
<p>Lamperti, Roventini, and Sani, "Agent-based model calibration using machine learning surrogates"</p>
</div>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/xgboost.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>  <span class="c1"># noqa: PLR0913</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_deduplication_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">candidate_pool_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">colsample_bytree</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">n_estimators</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sampler based on a xgboost surrogate model of the loss function.</span>

<span class="sd">    Note: this class makes use of the xgboost library, for more information on the XGBoost parameters</span>
<span class="sd">        visit https://xgboost.readthedocs.io/en/stable/parameter.html.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch_size: the number of points sampled every time the sampler is called</span>
<span class="sd">        random_state: the random state of the sampler, fixing this number the sampler behaves deterministically</span>
<span class="sd">        max_deduplication_passes: the maximum number of deduplication passes</span>
<span class="sd">        candidate_pool_size: number of randomly sampled points on which the random forest predictions are evaluated</span>
<span class="sd">        colsample_bytree: subsample ratio of columns when constructing each tree</span>
<span class="sd">        learning_rate: the learning rate</span>
<span class="sd">        max_depth: maximum depth of XGBoost trees</span>
<span class="sd">        alpha: L1 regularization term on weights</span>
<span class="sd">        n_estimators: number of estimators</span>

<span class="sd">    References:</span>
<span class="sd">        Lamperti, Roventini, and Sani, &quot;Agent-based model calibration using machine learning surrogates&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">batch_size</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">,</span>
        <span class="n">max_deduplication_passes</span><span class="p">,</span>
        <span class="n">candidate_pool_size</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_colsample_bytree</span> <span class="o">=</span> <span class="n">colsample_bytree</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_max_depth</span> <span class="o">=</span> <span class="n">max_depth</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="n">alpha</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_n_estimators</span> <span class="o">=</span> <span class="n">n_estimators</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_xg_regressor</span><span class="p">:</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.xgboost.XGBoostSampler.fit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Fit a xgboost surrogate model.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/xgboost.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># noqa: N803</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit a xgboost surrogate model.&quot;&quot;&quot;</span>
    <span class="c1"># prepare data</span>
    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clip_losses</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">DMatrix</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

    <span class="c1"># train surrogate</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_xg_regressor</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span>
        <span class="n">objective</span><span class="o">=</span><span class="s2">&quot;reg:squarederror&quot;</span><span class="p">,</span>  <span class="c1"># original: objective =&#39;reg:linear&#39;,</span>
        <span class="n">colsample_bytree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colsample_bytree</span><span class="p">,</span>
        <span class="n">learning_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_depth</span><span class="p">,</span>  <span class="c1"># original: 5</span>
        <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_estimators</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_random_seed</span><span class="p">(),</span>
    <span class="p">)</span>  <span class="c1"># original: 10</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_xg_regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.xgboost.XGBoostSampler.predict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Predict using a xgboost surrogate model.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/xgboost.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>  <span class="c1"># noqa: N803</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Predict using a xgboost surrogate model.&quot;&quot;&quot;</span>
    <span class="c1"># predict over large pool of candidates</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">DMatrix</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_xg_regressor</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;xgb.XGBRegressor&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xg_regressor</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xg_regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">

<a id="black_it.samplers.particle_swarm.ParticleSwarmSampler"></a>
    <div class="doc doc-contents first">

      <p>Implementation of a particle swarm sampler.</p>
<p>This sampler implements the particle swarm sampling method commonly used in particle swarm optimization (PSO),
introduced in:</p>
<div class="codehilite"><pre><span></span><code>Eberhart, Russell, and James Kennedy. &quot;A new optimizer using particle swarm theory.&quot;
  MHS&#39;95. Proceedings of the sixth international symposium on micro machine and human science. IEEE, 1995.
</code></pre></div>

<p>In a particle swarm optimizer, there is a set of particles that are "evolved" by cooperation and competition
among the individuals themselves through generations. Each particle adjusts its flying  according to its own
flying experience and its companions' flying experience. Each particle, in fact, represents a potential solution
to a problem. Each particle is treated as a point in a D-dimensional space.  The ith particle is represented as
Xi = (x_{i1},...,x_{iD}). The best previous position (the position giving the best fitness value) of any particle
is recorded and represented as Pi = (p_{i1},...,p_{iD}). The index of the best particle among all the particles
in the population is represented by the symbol g. The rate of the position change (velocity) for particle i is
represented as Vi = (v_{i1},...,v_{iD}). The particles are manipulated according to the following equation:</p>
<div class="codehilite"><pre><span></span><code>v_{id} = ( <span class="gs">* v_{id}) + (c1 *</span> r1 <span class="gs">* (p_{id} - x_{id})) + (c2 *</span> r2 * (p_{gd} - x_{id})
x_{id} = x_{id} + v_{id}
</code></pre></div>

<div class="admonition where">
<p class="admonition-title">Where</p>
<ul>
<li> is the inertia weight  to control the influence of the previous velocity;</li>
<li>c1 and c2 are positive values that represent the acceleration constants;</li>
<li>r1 and r2 are two random numbers uniformly distributed in the range of (0, 1).</li>
</ul>
</div>
<p>Note that p_{gd}, the global best position found across the dynamics, can optionally be computed by also
considering the sampling performed by other samplers in order to let them interfere constructively with the
Particle Swarm Sampler.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/particle_swarm.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ParticleSwarmSampler</span><span class="p">(</span><span class="n">BaseSampler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implementation of a particle swarm sampler.</span>

<span class="sd">    This sampler implements the particle swarm sampling method commonly used in particle swarm optimization (PSO),</span>
<span class="sd">    introduced in:</span>

<span class="sd">        Eberhart, Russell, and James Kennedy. &quot;A new optimizer using particle swarm theory.&quot;</span>
<span class="sd">          MHS&#39;95. Proceedings of the sixth international symposium on micro machine and human science. IEEE, 1995.</span>

<span class="sd">    In a particle swarm optimizer, there is a set of particles that are &quot;evolved&quot; by cooperation and competition</span>
<span class="sd">    among the individuals themselves through generations. Each particle adjusts its flying  according to its own</span>
<span class="sd">    flying experience and its companions&#39; flying experience. Each particle, in fact, represents a potential solution</span>
<span class="sd">    to a problem. Each particle is treated as a point in a D-dimensional space.  The ith particle is represented as</span>
<span class="sd">    Xi = (x_{i1},...,x_{iD}). The best previous position (the position giving the best fitness value) of any particle</span>
<span class="sd">    is recorded and represented as Pi = (p_{i1},...,p_{iD}). The index of the best particle among all the particles</span>
<span class="sd">    in the population is represented by the symbol g. The rate of the position change (velocity) for particle i is</span>
<span class="sd">    represented as Vi = (v_{i1},...,v_{iD}). The particles are manipulated according to the following equation:</span>

<span class="sd">        v_{id} = ( * v_{id}) + (c1 * r1 * (p_{id} - x_{id})) + (c2 * r2 * (p_{gd} - x_{id})</span>
<span class="sd">        x_{id} = x_{id} + v_{id}</span>

<span class="sd">    Where:</span>
<span class="sd">        -  is the inertia weight  to control the influence of the previous velocity;</span>
<span class="sd">        - c1 and c2 are positive values that represent the acceleration constants;</span>
<span class="sd">        - r1 and r2 are two random numbers uniformly distributed in the range of (0, 1).</span>

<span class="sd">    Note that p_{gd}, the global best position found across the dynamics, can optionally be computed by also</span>
<span class="sd">    considering the sampling performed by other samplers in order to let them interfere constructively with the</span>
<span class="sd">    Particle Swarm Sampler.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">inertia</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
        <span class="n">c1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">c2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">global_minimum_across_samplers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the sampler.</span>

<span class="sd">        Args:</span>
<span class="sd">            batch_size: the number of points sampled every time the sampler is called</span>
<span class="sd">            random_state: the random state of the sampler, fixing this number the sampler behaves deterministically</span>
<span class="sd">            inertia: the inertia of the particles&#39; motion</span>
<span class="sd">            c1: first acceleration constant</span>
<span class="sd">            c2: second acceleration constant</span>
<span class="sd">            global_minimum_across_samplers: if True, the global minimum attractor of the particles&#39; dynamics is computed</span>
<span class="sd">                taking into consideration also parameters sampled by other samplers, default is False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># max_duplication_passes must be zero because the sampler is stateful</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">batch_size</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
            <span class="n">max_deduplication_passes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># The batch size is the number of sampled parameters per iteration. In a Black-it sampler, each call to</span>
        <span class="c1"># sample_batch represent an iteration of the particle swarm sampler, so it seems natural to set the number of</span>
        <span class="c1"># particles to the batch size, as at each iteration sample_batch returns the current positions of the</span>
        <span class="c1"># particles.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_particles</span> <span class="o">=</span> <span class="n">batch_size</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_inertia</span> <span class="o">=</span> <span class="n">positive_float</span><span class="p">(</span><span class="n">inertia</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_c1</span> <span class="o">=</span> <span class="n">positive_float</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_c2</span> <span class="o">=</span> <span class="n">positive_float</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_global_minimum_across_samplers</span> <span class="o">=</span> <span class="n">global_minimum_across_samplers</span>

        <span class="c1"># all current particle positions; shape=(nb_particles, space dimensions)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_positions</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># all current particle velocities; shape=(nb_particles, space dimensions)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_velocities</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># best particle positions, i.e. ; shape=(nb_particles, space dimensions)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_best_particle_positions</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># losses of the best positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_best_position_losses</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># particle id of the global best particle position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_global_best_particle_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># best point in parameter space - could be the best across samplers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_best_point</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_batch_index_start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_set_up</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return true iff the sampler is already set up.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_positions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">inertia</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the inertia weight.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inertia</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">c1</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the c1 constant.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c1</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">c2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the c2 constant.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c2</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up the sampler.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">random</span><span class="p">(</span>
            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">dims</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_velocities</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">random</span><span class="p">(</span>
                <span class="n">size</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;NDArray&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_positions</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">-</span> <span class="mf">0.5</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_best_particle_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_positions</span>
        <span class="c1"># set losses to inf as we are interested to the min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_best_position_losses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_particles</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="c1"># we don&#39;t know yet which is the best index - initialize to 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_global_best_particle_id</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_best_position</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the position corresponding to the global optimum the particles should converge to.</span>

<span class="sd">        If _global_minimum_across_samplers is False, then this method returns the current position</span>
<span class="sd">        of the particle that in its history has sampled, so far, the best set of parameters.</span>

<span class="sd">        Else, if _global_minimum_across_samplers is True, then this method returns the point</span>
<span class="sd">        in parameter space that achieved the minimum loss. Note that this point could have been</span>
<span class="sd">        sampled by a different sampler than &quot;self&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            a Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global_minimum_across_samplers</span><span class="p">:</span>
            <span class="n">best_particle_positions</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;NDArray&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_particle_positions</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">best_particle_positions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_global_best_particle_id</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;NDArray&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_point</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the sampler.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_positions</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_velocities</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_best_particle_positions</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_best_position_losses</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_global_best_particle_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_batch_index_start</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">_assert</span><span class="p">(</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_set_up</span><span class="p">,</span>
            <span class="n">error_message</span><span class="o">=</span><span class="s2">&quot;reset call did not work, sampler still set up&quot;</span><span class="p">,</span>
            <span class="n">exception_class</span><span class="o">=</span><span class="ne">RuntimeError</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>  <span class="c1"># noqa: ARG002</span>
        <span class="n">search_space</span><span class="p">:</span> <span class="n">SearchSpace</span><span class="p">,</span>
        <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sample a batch of parameters.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_set_up</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_up</span><span class="p">(</span><span class="n">search_space</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_previous_batch_index_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_points</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">digitize_data</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;NDArray[np.float64]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_particle_positions</span><span class="p">),</span>
                <span class="n">search_space</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_best</span><span class="p">(</span><span class="n">existing_points</span><span class="p">,</span> <span class="n">existing_losses</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_step</span><span class="p">()</span>

        <span class="n">p_bounds</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_space</span><span class="o">.</span><span class="n">parameters_bounds</span>
        <span class="n">sampled_points</span> <span class="o">=</span> <span class="n">p_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_positions</span> <span class="o">*</span> <span class="p">(</span><span class="n">p_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_batch_index_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_points</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">digitize_data</span><span class="p">(</span><span class="n">sampled_points</span><span class="p">,</span> <span class="n">search_space</span><span class="o">.</span><span class="n">param_grid</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_best</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the best local and global positions.&quot;&quot;&quot;</span>
        <span class="n">_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_previous_batch_index_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">exception_class</span><span class="o">=</span><span class="ne">AssertionError</span><span class="p">,</span>
            <span class="n">error_message</span><span class="o">=</span><span class="s2">&quot;should have been set&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># set best loss and best point</span>
        <span class="n">best_point_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">existing_losses</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_best_point</span> <span class="o">=</span> <span class="n">existing_points</span><span class="p">[</span><span class="n">best_point_index</span><span class="p">]</span>

        <span class="c1"># set best particle position</span>
        <span class="n">batch_index_start</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_batch_index_start</span><span class="p">)</span>
        <span class="n">batch_index_stop</span> <span class="o">=</span> <span class="n">batch_index_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span>
        <span class="n">previous_points</span> <span class="o">=</span> <span class="n">existing_points</span><span class="p">[</span><span class="n">batch_index_start</span><span class="p">:</span><span class="n">batch_index_stop</span><span class="p">]</span>
        <span class="n">previous_losses</span> <span class="o">=</span> <span class="n">existing_losses</span><span class="p">[</span><span class="n">batch_index_start</span><span class="p">:</span><span class="n">batch_index_stop</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">particle_id</span><span class="p">,</span> <span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">loss</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">previous_points</span><span class="p">,</span> <span class="n">previous_losses</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="n">best_particle_positions</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;NDArray&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_particle_positions</span><span class="p">)</span>
            <span class="n">best_position_losses</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;NDArray&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_position_losses</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">best_position_losses</span><span class="p">[</span><span class="n">particle_id</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">loss</span><span class="p">:</span>
                <span class="n">best_particle_positions</span><span class="p">[</span><span class="n">particle_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">point</span>
                <span class="n">best_position_losses</span><span class="p">[</span><span class="n">particle_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">loss</span>

                <span class="c1"># check if also the global best should be updated</span>
                <span class="n">best_global_loss</span> <span class="o">=</span> <span class="n">best_position_losses</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_global_best_particle_id</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">loss</span> <span class="o">&lt;</span> <span class="n">best_global_loss</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_global_best_particle_id</span> <span class="o">=</span> <span class="n">particle_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_do_step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Do a step by updating particle positions and velocities.&quot;&quot;&quot;</span>
        <span class="n">curr_particle_positions</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;NDArray&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_positions</span><span class="p">)</span>
        <span class="n">curr_particle_velocities</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;NDArray&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_velocities</span><span class="p">)</span>
        <span class="n">best_particle_positions</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;NDArray&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_particle_positions</span><span class="p">)</span>
        <span class="n">r1_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">curr_particle_positions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">r2_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_generator</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">curr_particle_positions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">new_particle_velocities</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inertia</span> <span class="o">*</span> <span class="n">curr_particle_velocities</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">c1</span> <span class="o">*</span> <span class="n">r1_vec</span> <span class="o">*</span> <span class="p">(</span><span class="n">best_particle_positions</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_positions</span><span class="p">)</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">c2</span> <span class="o">*</span> <span class="n">r2_vec</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_best_position</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_positions</span><span class="p">)</span>  <span class="c1"># type: ignore[operator]</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_positions</span> <span class="o">+</span> <span class="n">new_particle_velocities</span><span class="p">,</span>
            <span class="n">a_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="n">a_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_velocities</span> <span class="o">=</span> <span class="n">new_particle_velocities</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h2 id="black_it.samplers.particle_swarm.ParticleSwarmSampler.c1" class="doc doc-heading">
<code class="highlight language-python"><span class="n">c1</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Get the c1 constant.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h2 id="black_it.samplers.particle_swarm.ParticleSwarmSampler.c2" class="doc doc-heading">
<code class="highlight language-python"><span class="n">c2</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Get the c2 constant.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h2 id="black_it.samplers.particle_swarm.ParticleSwarmSampler.inertia" class="doc doc-heading">
<code class="highlight language-python"><span class="n">inertia</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Get the inertia weight.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h2 id="black_it.samplers.particle_swarm.ParticleSwarmSampler.is_set_up" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_set_up</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Return true iff the sampler is already set up.</p>
    </div>

  </div>






  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.particle_swarm.ParticleSwarmSampler.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inertia</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">c1</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">c2</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">global_minimum_across_samplers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Initialize the sampler.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>batch_size</code></td>
        <td><code>int</code></td>
        <td><p>the number of points sampled every time the sampler is called</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>random_state</code></td>
        <td><code>int | None</code></td>
        <td><p>the random state of the sampler, fixing this number the sampler behaves deterministically</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>inertia</code></td>
        <td><code>float</code></td>
        <td><p>the inertia of the particles' motion</p></td>
        <td><code>0.9</code></td>
      </tr>
      <tr>
        <td><code>c1</code></td>
        <td><code>float</code></td>
        <td><p>first acceleration constant</p></td>
        <td><code>0.1</code></td>
      </tr>
      <tr>
        <td><code>c2</code></td>
        <td><code>float</code></td>
        <td><p>second acceleration constant</p></td>
        <td><code>0.1</code></td>
      </tr>
      <tr>
        <td><code>global_minimum_across_samplers</code></td>
        <td><code>bool</code></td>
        <td><p>if True, the global minimum attractor of the particles' dynamics is computed
taking into consideration also parameters sampled by other samplers, default is False</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>black_it/samplers/particle_swarm.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">inertia</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
    <span class="n">c1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">c2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">global_minimum_across_samplers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the sampler.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch_size: the number of points sampled every time the sampler is called</span>
<span class="sd">        random_state: the random state of the sampler, fixing this number the sampler behaves deterministically</span>
<span class="sd">        inertia: the inertia of the particles&#39; motion</span>
<span class="sd">        c1: first acceleration constant</span>
<span class="sd">        c2: second acceleration constant</span>
<span class="sd">        global_minimum_across_samplers: if True, the global minimum attractor of the particles&#39; dynamics is computed</span>
<span class="sd">            taking into consideration also parameters sampled by other samplers, default is False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># max_duplication_passes must be zero because the sampler is stateful</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">batch_size</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
        <span class="n">max_deduplication_passes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># The batch size is the number of sampled parameters per iteration. In a Black-it sampler, each call to</span>
    <span class="c1"># sample_batch represent an iteration of the particle swarm sampler, so it seems natural to set the number of</span>
    <span class="c1"># particles to the batch size, as at each iteration sample_batch returns the current positions of the</span>
    <span class="c1"># particles.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nb_particles</span> <span class="o">=</span> <span class="n">batch_size</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_inertia</span> <span class="o">=</span> <span class="n">positive_float</span><span class="p">(</span><span class="n">inertia</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_c1</span> <span class="o">=</span> <span class="n">positive_float</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_c2</span> <span class="o">=</span> <span class="n">positive_float</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_global_minimum_across_samplers</span> <span class="o">=</span> <span class="n">global_minimum_across_samplers</span>

    <span class="c1"># all current particle positions; shape=(nb_particles, space dimensions)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_positions</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># all current particle velocities; shape=(nb_particles, space dimensions)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_velocities</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># best particle positions, i.e. ; shape=(nb_particles, space dimensions)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_best_particle_positions</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># losses of the best positions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_best_position_losses</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># particle id of the global best particle position</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_global_best_particle_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># best point in parameter space - could be the best across samplers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_best_point</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_previous_batch_index_start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.particle_swarm.ParticleSwarmSampler.reset" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Reset the sampler.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/particle_swarm.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reset the sampler.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_positions</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_velocities</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_best_particle_positions</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_best_position_losses</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_global_best_particle_id</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_previous_batch_index_start</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_assert</span><span class="p">(</span>
        <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_set_up</span><span class="p">,</span>
        <span class="n">error_message</span><span class="o">=</span><span class="s2">&quot;reset call did not work, sampler still set up&quot;</span><span class="p">,</span>
        <span class="n">exception_class</span><span class="o">=</span><span class="ne">RuntimeError</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="black_it.samplers.particle_swarm.ParticleSwarmSampler.sample_batch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sample_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">search_space</span><span class="p">,</span> <span class="n">existing_points</span><span class="p">,</span> <span class="n">existing_losses</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Sample a batch of parameters.</p>

        <details class="quote">
          <summary>Source code in <code>black_it/samplers/particle_swarm.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>  <span class="c1"># noqa: ARG002</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">SearchSpace</span><span class="p">,</span>
    <span class="n">existing_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">existing_losses</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample a batch of parameters.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_set_up</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_up</span><span class="p">(</span><span class="n">search_space</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_batch_index_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_points</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">digitize_data</span><span class="p">(</span>
            <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;NDArray[np.float64]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_particle_positions</span><span class="p">),</span>
            <span class="n">search_space</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_update_best</span><span class="p">(</span><span class="n">existing_points</span><span class="p">,</span> <span class="n">existing_losses</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_do_step</span><span class="p">()</span>

    <span class="n">p_bounds</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_space</span><span class="o">.</span><span class="n">parameters_bounds</span>
    <span class="n">sampled_points</span> <span class="o">=</span> <span class="n">p_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curr_particle_positions</span> <span class="o">*</span> <span class="p">(</span><span class="n">p_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_previous_batch_index_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_points</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">digitize_data</span><span class="p">(</span><span class="n">sampled_points</span><span class="p">,</span> <span class="n">search_space</span><span class="o">.</span><span class="n">param_grid</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": [], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>